---
title: "final"
author: "esther"
date: "11/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
```

```{r mode}
#mode of factor variables
calculate_mode <- function(x) {
  uniqx <- unique(x)
  uniqx[which.max(tabulate(match(x, uniqx)))]
}
```
The Metro Interstate Traffic volume dataset is from UCI Machine Learning Repostitory, data is taken from Minneapolis-St Paul, MN traffic volume for westbound I-94. There are nine variables and 48,204 observations of every hour from 2012 to 2018. 

Variables:
holiday - categorical indicating if there was a holiday
temperature - temperature in kelvin
rain_1h - rain in mm that occured in the hour
snow_1h snow in mm that occured in the hour
clouds_all - cloud cover percentage
weather_main - description of weather
weather_descrription - long description
date_time - hour of data collected
traffic_volume - numeric hourly average true range of traffic volume

```{r data}
#read in data
traffic <- read_csv("Metro_Interstate_Traffic_Volume.csv")
head(traffic)
dim(traffic)
```

```{r adddinggg stuffff cuz im bored}
unique(traffic$weather_main)
#change columns into new dataframe df
df <- traffic %>%
        mutate(
          temp = temp - 270.15,
          weather_main = factor(weather_main),
          holiday = ifelse(holiday == "None", 0, holiday) %>% as.numeric,
          holiday = ifelse(is.na(holiday), 1, 0) %>% as.numeric)

#new columns
df$date <- as.Date(traffic$date_time, "%m/%d/%Y")
df$day <- weekdays(df$date)
df$hour <- strftime(traffic$date_time, format="%H:%M:%S")
```

```{r}
#ordering days 
df$day <- ordered(df$day, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", 
"Friday", "Saturday", "Sunday"))
```

```{r plots}
holiday <- traffic %>% filter(holiday != "None")

ggplot(holiday, aes(x = holiday)) +
  geom_bar()

#there are very few holidays 
```
```{r}
ggplot(df, aes(y = temp)) +
  geom_boxplot()

#there is an outlier we'll have to chop it 
```
```{r}
ggplot(traffic, aes(x = weather_main)) +
  geom_bar()
```
```{r}
ggplot(traffic, aes(x = weather_description)) +
  geom_bar()
```
```{r}
ggplot(traffic, aes(x = clouds_all)) +
  geom_bar()
```
```{r bp}
#boxplot
ggplot(traffic, aes(x=weather_main, y=traffic_volume, group=weather_main)) + 
  geom_boxplot(aes(fill=weather_main))
```
```{r bp}
#boxplot
ggplot(holiday, aes(x=holiday, y=traffic_volume, group=holiday)) + 
  geom_boxplot(aes(fill=holiday))
```

```{r avg mlr}
mlr <- lm()
```

```{r model}


```
```{r daily info}
#taking the average of each variable by date
daily_mean_temp <- df %>% group_by(date) %>% summarize(temp = mean(temp))
daily_mean_vol <- traffic %>% group_by(date) %>% summarize(vol = mean(traffic_volume))
daily_mean_rain <- traffic %>% group_by(date) %>% summarize(rain = mean(rain_1h))
daily_mean_snow <- traffic %>% group_by(date) %>% summarize(snow = mean(snow_1h))
daily_mean_cloud <- traffic %>% group_by(date) %>% summarize(cloud = mean(clouds_all))
is_holiday <- df %>% group_by(date) %>% summarize(holiday = mean(holiday))
daily_day <- traffic %>% group_by(date) %>% 
```

```{r weather}
x <- traffic %>% group_by(date) %>% select(weather_main)

daily_weather <- x %>% group_by(date) %>% summarize(weather = calculate_mode(weather_main))
```

```{r average df}
avg <- merge(daily_weather, merge(is_holiday, merge(daily_mean_cloud, merge(daily_mean_snow, merge(daily_mean_rain,merge(daily_mean_temp, daily_mean_vol))))))
```

```{r avg format}
avg %>% 
  mutate(
    holiday = ifelse(holiday != 0, 1, 0),
  )
```
```{r sample}
sample <- sample_n(df, 1000, replace = FALSE)
```