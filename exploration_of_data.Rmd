---
title: "final"
author: "esther"
date: "11/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
```

```{r mode}
#mode of factor variables
calculate_mode <- function(x) {
  uniqx <- unique(x)
  uniqx[which.max(tabulate(match(x, uniqx)))]
}
```
The Metro Interstate Traffic volume dataset is from UCI Machine Learning Repostitory. There are nine variables and 48,204 observations of every hour since 2012 to 2018. Holiday is a binary variable indicating whether it was a holiday. Temperature is the temperature at each time in Kelvin. Snow is the amount of snow that fell in the past hour, and rain is the amount of rain that fell in the past hour. Cloud is the percentage of cloud cover. Weather main and weather description indicate the weather. Date and time is the local time of the data collection. There are a couple of options for working with this data to predict the traffic volume given this set of variables.
```{r data}
#read in data
traffic <- read_csv("~/dataset/Metro_Interstate_Traffic_Volume.csv")
head(traffic)
```

```{r formatting}
unique(traffic$weather_main)
#change columns into new dataframe df
df <- traffic %>%
        mutate(
          temp = temp - 270.15,
          weather_main = factor(weather_main),
          holiday = ifelse(holiday == "None", 0, holiday) %>% as.numeric,
          holiday = ifelse(is.na(holiday), 1, 0) %>% as.numeric)

#new columns
df$date <- as.Date(traffic$date_time, "%m/%d/%Y")
df$day <- weekdays(traffic$date)
df$hour <- strftime(traffic$date_time, format="%H:%M:%S")
```

```{r}
#ordering days 
df$day <- ordered(df$day, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", 
"Friday", "Saturday", "Sunday"))
```

```{r average by day}
#taking the average of each variable by date
daily_mean_temp <- df %>% group_by(date) %>% summarize(temp = mean(temp))
daily_mean_vol <- traffic %>% group_by(date) %>% summarize(vol = mean(traffic_volume))
daily_mean_rain <- traffic %>% group_by(date) %>% summarize(rain = mean(rain_1h))
daily_mean_snow <- traffic %>% group_by(date) %>% summarize(snow = mean(snow_1h))
daily_mean_cloud <- traffic %>% group_by(date) %>% summarize(cloud = mean(clouds_all))
is_holiday <- df %>% group_by(date) %>% summarize(holiday = mean(holiday))
daily_day <- traffic %>% group_by(date) %>% 
```

```{r weather}
x <- traffic %>% group_by(date) %>% select(weather_main)

daily_weather <- x %>% group_by(date) %>% summarize(weather = calculate_mode(weather_main))
```

```{r average df}
avg <- merge(daily_weather, merge(is_holiday, merge(daily_mean_cloud, merge(daily_mean_snow, merge(daily_mean_rain,merge(daily_mean_temp, daily_mean_vol))))))
```



```{r avg format}
avg %>% 
  mutate(
    holiday = ifelse(holiday != 0, 1, 0),
  )
```
```{r sample}
sample <- sample_n(df, 1000, replace = FALSE)
```

```{r plot}
plot(avg$temp, avg$vol)
plot(avg$cloud, avg$vol)


d <- ggplot(sample, aes(x = day, y = traffic_volume, group = day)) +
  geom_boxplot()
d
```

```{r bp}
#boxplot
bp <- ggplot(traffic, aes(x=weather_main, y=traffic_volume, group=weather_main)) + 
  geom_boxplot(aes(fill=weather_main))
bp
```

```{r avg mlr}
mlr <- lm()
```



```{r model}


```