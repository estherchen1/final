---
title: "final"
author: "esther"
date: "11/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
library(repr)

options(repr.plot.width=5, repr.plot.height=4)
```
The Metro Interstate Traffic volume dataset is from UCI Machine Learning Repostitory, data is taken from Minneapolis-St Paul, MN traffic volume for westbound I-94. There are nine variables and 48,204 observations of every hour from 2012 to 2018. 

Variables:
holiday - categorical indicating if there was a holiday
temperature - temperature in kelvin
rain_1h - rain in mm that occured in the hour
snow_1h snow in mm that occured in the hour
clouds_all - cloud cover percentage
weather_main - description of weather
weather_descrription - long description
date_time - hour of data collected
traffic_volume - numeric hourly average true range of traffic volume

```{r data}
#read in data
traffic <- read_csv("Metro_Interstate_Traffic_Volume.csv")
head(traffic)
dim(traffic)
summary(traffic$traffic_volume)
```

```{r data edit}
unique(traffic$weather_main)
#change columns into new dataframe df
df <- traffic %>%
        mutate(
          temp = temp - 270.15,
          weather_main = factor(weather_main),
          holiday = ifelse(holiday == "None", 0, holiday) %>% as.numeric,
          holiday = ifelse(is.na(holiday), 1, 0) %>% as.numeric)
```
```{r adding columns}
#new columns
df$date <- as.Date(traffic$date_time, "%m/%d/%Y")
df$day <- weekdays(df$date)
df$hour <- strftime(traffic$date_time, format="%H", tz = "CST")
df$hournum <- as.numeric(df$hour)
```
```{r adding years}
df$year <- strftime(traffic$date_time, format="%Y")
```
```{r}
df$month <- month(traffic$date_time)
df$monthnum <- as.numeric(df$month)
```
```{r adding times}
df$tod <- ifelse(df$hournum >= 03 & df$hournum <= 07 , "Early Morning",
            ifelse(df$hournum > 07 & df$hournum <= 11, "Morning",
            ifelse(df$hournum > 11 & df$hournum <= 17, "Afternoon", 
            ifelse(df$hournum > 17 & df$hournum <= 20, "Evening", "Night"))))
```
```{r https://stackoverflow.com/a/46846474 source}
#mode of factor variables
calculate_mode <- function(x) {
  uniqx <- unique(x)
  uniqx[which.max(tabulate(match(x, uniqx)))]
}
```
```{r https://stackoverflow.com/a/9501225 source}
getSeason <- function(DATES) {
    WS <- as.Date("2012-12-15", format = "%Y-%m-%d") # Winter Solstice
    SE <- as.Date("2012-3-15",  format = "%Y-%m-%d") # Spring Equinox
    SS <- as.Date("2012-6-15",  format = "%Y-%m-%d") # Summer Solstice
    FE <- as.Date("2012-9-15",  format = "%Y-%m-%d") # Fall Equinox

    # Convert dates from any year to 2012 dates
    d <- as.Date(strftime(DATES, format="2012-%m-%d"))

    ifelse (d >= WS | d < SE, "Winter",
      ifelse (d >= SE & d < SS, "Spring",
        ifelse (d >= SS & d < FE, "Summer", "Fall")))
}
```
```{r add season}
df$season <- getSeason(df$date_time)
```
```{r make time of day a factor}
df %>% mutate(tod = as.factor(tod))
```
```{r order time of day}
df$tod <- ordered(df$tod, levels = c("Early Morning", "Morning", "Afternoon", "Evening", "Night"))
```

```{r order days}
#ordering days 
df$day <- ordered(df$day, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", 
"Friday", "Saturday", "Sunday"))
```

```{r}
ggplot(traffic, aes(x = traffic_volume)) +
  geom_histogram(bins = 40)
```


```{r holiday histogram}
holiday <- traffic %>% filter(holiday != "None")

ggplot(holiday, aes(x = holiday)) +
  geom_bar()
#there are few holidays 
```
```{r temperature boxplot}
ggplot(df, aes(y = temp)) +
  geom_boxplot() + 
  facet_wrap(~year)
```
```{r weather histogram}
ggplot(traffic, aes(x = weather_main)) +
  geom_bar() 
```
```{r weather description histogram}
ggplot(traffic, aes(x = weather_description)) +
  geom_bar()
```

```{r cloudcover histogram}
ggplot(traffic, aes(x = clouds_all)) +
  geom_bar()
```

```{r numerical plots}
plot(df$clouds_all, df$traffic_volume)
plot(df$snow_1h, df$traffic_volume)
plot(df$rain_1h, df$traffic_volume)
```

```{r weather and volume}
ggplot(traffic, aes(x=weather_main, y=traffic_volume, group=weather_main)) + 
  geom_boxplot()

ggplot(traffic, aes(x = weather_main, y = traffic_volume, group = weather_main)) +
  geom_bar(stat = "identity")
```
```{r weather desc and volume}
ggplot(traffic, aes(x = weather_description, y = traffic_volume, group = weather_description)) +
  geom_boxplot()
```
```{r holiday and volume}
#boxplot
ggplot(holiday, aes(x=holiday, y=traffic_volume, group=holiday)) + 
  geom_boxplot()

ggplot(holiday, aes(x = holiday, y = traffic_volume, group = holiday)) +
  geom_bar(stat = "identity")
```
```{r day of week and volume}
ggplot(df, aes(x = day, y = traffic_volume, group = day)) +
  geom_boxplot()

ggplot(df, aes(x = day, y = traffic_volume, group = day)) +
  geom_bar(stat = "identity")
```
```{r}
ggplot(df, aes(x = tod, y = traffic_volume, group = tod)) +
  geom_boxplot()

ggplot(df, aes(x = tod, y = traffic_volume, group = tod)) +
  geom_bar(stat = "identity")
```
```{r}
ggplot(df, aes(x = year, y = traffic_volume)) +
  geom_boxplot() 
```

```{r}
slr <- lm(traffic_volume ~ day, data = df)
summary(slr)

plot(df$day, df$traffic_volume)
abline(lm(traffic_volume ~ day, data = df))
```
```{r}
df$temp = ifelse(df$temp < -50, 0, df$temp)

plot(df$temp, df$traffic_volume)
abline(lm(traffic_volume ~ temp, data = df))
```
```{r}
plot(df$clouds_all, df$traffic_volume)
plot(df$weather_main, df$temp)
```
```{r data into years}
twelve <- df %>% filter(year == 2012)
thirteen <- df %>% filter(year == 2013)
fourteen <- df %>% filter(year == 2014)
fifteen <- df %>% filter(year == 2015)
sixteen <- df %>% filter(year == 2016)
seventeen <- df %>% filter(year == 2017)
eighteen <- df %>% filter(year == 2018)
```
```{r temperature traffic}
plot(twelve$temp, twelve$traffic_volume)
plot(thirteen$temp, thirteen$traffic_volume)
plot(fourteen$temp, fourteen$traffic_volume)
plot(fifteen$temp, fifteen$traffic_volume)
plot(sixteen$temp, sixteen$traffic_volume)
plot(seventeen$temp, seventeen$traffic_volume)
plot(eighteen$temp, eighteen$traffic_volume)
```
```{r}
ggplot(df, aes(x = year, y = temp, group = year)) +
  geom_boxplot()

ggplot(df, aes(x = month, y = temp, group = month)) +
  geom_boxplot()
```
```{r}
ggplot(seventeen, aes(x = season, y = traffic_volume, group = season)) +
  geom_boxplot()
```
```{r hours}
ggplot(df, aes(x = hournum, y = traffic_volume, group = hournum)) +
  geom_boxplot()

ggplot(seventeen, aes(x = hournum, y = traffic_volume, group = hournum)) +
  geom_boxplot()

ggplot(sixteen, aes(X = hournum, y = traffic_volume, group = hournum)) +
  geom_boxplot()

#is it necessary to go by hour?? ??
```
```{r}
ggplot(df, aes(x = year, y = traffic_volume, group = year)) +
  geom_boxplot()

ggplot(df, aes(x = monthnum, y = traffic_volume, group = month)) +
  geom_boxplot()

ggplot(seventeen, aes(x = monthnum, y = traffic_volume, group = month)) +
  geom_boxplot()
```
```{r}
ggplot(df, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
    facet_wrap(~day)
```
```{r}
df_select <- df %>% filter(season == "Fall")
ggplot(df_select, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
df_select <- df %>% filter(season == "Winter")
ggplot(df_select, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
df_select <- df %>% filter(season == "Spring")
ggplot(df_select, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
df_select <- df %>% filter(season == "Summer")
ggplot(df_select, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```

```{r}
ggplot(twelve, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
ggplot(thirteen, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
ggplot(fourteen, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
ggplot(fifteen, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
ggplot(sixteen, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
ggplot(seventeen, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```
```{r}
ggplot(eighteen, aes(x = hournum, y = traffic_volume)) +
  geom_point() +
  facet_wrap(~day)
```